# 第2章 结构化提示设计

## 2.1 结构引导设计

### 2.1.1 层次结构

```
# 任务描述
# 输出限制
# 输出示例
```

### 2.1.2 输入和输出位置

```
# 任务描述
你是一个中文翻译助手，你的任务是把下面这段文本翻译为英文。

# 输入
小雪是一只6岁的雌性大熊猫，体重95公斤，身长1.5米，毛色黑白相间，胸前有一颗心形的黑斑，主要吃竹子。

# 输出
->
```

### 2.1.3 有序列表和无序列表

```
# 任务描述
作为一名动物学家，你的任务是基于“素材库”为用户回答一些关于动物的提问：

# 素材库
- 在横断山的东端，有一条介于长江和黄河的狭长的绿色走廊，就是大熊猫走廊带。大熊猫走廊带纵横中国的四川、陕西和甘肃三省，这条走廊也是世界上唯一的大熊猫栖息地……（略）
- 生活在野外的大熊猫，总是能找到一条充满智慧和富有生趣的生存之路。几百万年前，为了摆脱与其他肉食动物的竞争，它们选择了一条素食之路，开始以竹子为主要食谱……（略）

# 用户提问
大熊猫吃肉吗？

# 输出
->
```

### 2.1.4 解释或补充说明

```
# 任务描述
作为一个内部网站的在线客服助手，你的任务是理解用户输入的问题，并回答用户应该跳转到哪个菜单。

# 网站菜单
- 产品论坛
- 生活论坛
- 技术论坛（主要包含软件开发技术的讨论和分享）
- 二手物品
- 行政关怀（主要包含礼品领取，停车位，员工旅游等功能）
- ERP系统（主要包含日常办公、审批相关功能，以及员工食堂充值等功能）

# 用户提问
在哪里充值饭卡？

# 输出
->
```

### 2.1.5 不可分割

```
“李明和王芳”的老师来了。
```

### 2.1.6 强调内容

```
# 任务描述
你是一个宠物商店的老板，请按照**动物名称, 所属科目, 尺寸大小**字段帮我推荐一只小宠物，直接输出**CSV**结果即可，无须额外解释。
```

### 2.1.7 语义槽位

输入：

```
# 任务描述
请按照<用户名>@<邮件服务商>.com格式从文本中抽取邮件地址。

# 文本内容
- 请您在收到此邮件后，通过我们的服务邮箱support@xxx.com与我们联系，以便我们进一步协调您的业务需求。
- 嘿，小伙伴！如果你想了解更多活动信息，欢迎发邮件到我们的活动组邮箱events@xxx.com，我们期待你的参与！
- 订阅我们的新闻简报，获取最新优惠信息。点击这里订阅或发送空白邮件至subscribe@xxx.com。

# 输出
->
```

输出:

```
support@xxx.com, events@xxx.com, subscribe@xxx.com
```

---

输入：

```
# 任务描述
你的任务是，基于用户输入按照如下模板填写内容：
“大家好，我给大家介绍一名新朋友，他的名字叫__，年龄__，职业__，爱好__。请大家热烈欢迎！”

# 输入
大家好，我来向大家介绍一下我自己。我叫小熙，今年12岁，是一名学生。除学业之外，我还有一个特别的爱好，那就是篮球。期待在未来的日子里，与大家共同学习、共同进步。
# 输出
->
```

输出：

```
大家好，我给大家介绍一名新朋友，他的名字叫小熙，年龄12岁，职业学生，爱好篮球。请大家热烈欢迎！
```

### 2.1.8 内容边界

输入：

```
<START>在一个月黑风高的夜晚，一个程序员掏出了他的MacBook
<END>随后一切都陷入了黑暗
请以<START>为开头、以<END>为结尾，生成一个不超过200字的科幻故事。
```

输出：

```
<START>在一个月黑风高的夜晚，一个程序员掏出了他的MacBook，突然，屏幕闪烁着神秘的光芒。他惊讶地发现，电脑屏幕上出现了一个未知程序，似乎是从未来传来的。这个程序显示了一串神秘代码，每一行都蕴含着未来科技的力量。他忍不住开始解读，但当他触及最后一行代码时，整个世界突然陷入了黑暗。

<END>随后一切都陷入了黑暗，只剩下MacBook的屏幕发出微弱的光。程序员惊觉，那段代码竟是一个时间跳跃程序，而他无意中触发了它，将整个世界带到了一个未知的时间点。黑暗中，他只有MacBook的微光陪伴，开始了一段未知的时空探险。
```

### 2.1.9 输出格式

输入：

```
# 任务描述
作为一个宠物商店的老板，请给客户推荐一只可爱小宠物。请按照**动物名称, 所属科目, 尺寸大小**字段生成一条CSV格式的宠物信息，无须解释。

# 输出
->
```

输出：

```
猫, 哺乳纲, 中等
```

---

输入：

```
# 任务描述
作为一个宠物商店的老板，请给客户推荐一只可爱小宠物。请按照KV格式生成一条数据，其中K为**动物名称, 所属科目, 尺寸大小**字段，V为对应的值，无须额外解释。
# 输出
``` kv
```

输出：

```
动物名称: 狗
所属科目: 哺乳纲
尺寸大小: 小
```

### 2.1.10 字段和数据类型

使用输出结构示例进行字段名称定义

输入：

````
# 任务描述
从给定的文本中提取信息，按照以下JSON结构输出，其中{}表示需要填充的内容：
``` json
{ "gender": "{}", "age": "{}", "job": "{}" }
```
# 输入
大家好，我是一个羞涩的小男孩，今年十二岁，还是个学生，在北京一零一中学读书。
# 输出
``` json
````

输出：

```
{ "gender": "男", "age": "12", "job": "学生" }
```

---

使用括号进行字段名称定义

输入：

```
# 任务描述
从给定的文本中提取性别（gender）、年龄（age）和职业（job）信息，按照JSON结构输出。文本如下：

# 输入
大家好，我是一个羞涩的小男孩，今年十二岁，还是个学生，在北京一零一中学读书。
# 输出
``` json
```

输出：

```
{ "gender": "男", "age": "十二岁", "job": "学生" }
```

---

使用{%format}（格式化字符串）标识字段数据类型

输入：

````
# 任务描述
从给定的文本中提取信息，按照以下JSON结构输出，其中{}表示需要填充的内容：
``` json
{ "gender": "{%s}", "age": {%d}, "job": "{%s}" }
```
# 输入
大家好，我是一个羞涩的小男孩，今年十二岁，还是个学生，在北京一零一中学读书。
# 输出
``` json
````

输出：

```
{ "gender": "男", "age": 12, "job": "学生" }
```

---

使用括号定义字段类型

输入：

```
# 任务描述
从给定的文本中提取性别（gender: int）、年龄（age: string）和职业（job: string）信息，按照JSON结构输出。文本如下：

# 输入
大家好，我是一个羞涩的小男孩，今年十二岁，还是个学生，在北京一零一中学读书。
# 输出
``` json
```

输出：

```
{ "gender": "男", "age": "十二岁", "job": "学生" }
```

### 2.1.11 输出长度控制

```
// 为4-5岁儿童创作一篇300-500字的童话故事。
// 故事应包含至少5个段落，不超过30句。
```

## 2.2 内容引导设计

### 2.2.1 模拟对话提示

````
# 任务描述
请用一句话总结下面的对话内容。

```text
A: 您好，我想了解一下你们银行的贷款产品。
B: 当然可以，我们的贷款产品种类丰富，包括住房贷款、汽车贷款、消费贷款等，您可以根据自身需求选择合适的产品。
A: 听起来不错，那我想了解一下房屋贷款。
……（略）
A: 听起来很简单，我明白了。谢谢您的帮助。
B: 不客气，如果您还有其他问题或需求，欢迎随时联系我们。祝您生活愉快！
```
# 输出
->
````

### 2.2.2 句式引导提示

```
请按照“地点：……气候：……景点：……”的格式介绍襄阳市。
请按照“步骤1、步骤2、步骤3”的格式，介绍如何制作饼干。
```

### 2.2.3 前导语提示

生成SQL代码

输入：

```
# 任务描述
你需要编写一段SQL代码，用来创建一个包括**order_id < bigint >，customer_name, order_date, order_amount**字段的数据表，并将订单ID设置为唯一主键。

# 输出
CREATE TABLE
```

输出：

```
IF NOT EXISTS orders (
    order_id BIGINT PRIMARY KEY,
    customer_name VARCHAR(255),
    order_date DATE,
    order_amount DECIMAL(10, 2)
);
```

---

续写故事

输入：

```
# 任务描述
在遥远的未来时空，星际旅行的技术已被人类熟练掌握，庞大的星际舰队在广袤无垠的宇宙中自由穿梭，勇往直前地探寻那些未曾触及的星球与文明。终于，在某一日，一支勇敢的探险队跨越星际，稳稳地降落在一颗名为塞菲罗斯的神秘星球之上

续写这个故事：
```

输出：

```
……（略）塞菲罗斯星球的表面布满了奇异的植物和矿物，空气中弥漫着一种未知的能量。探险队的科学家们立即开始了紧张而有序的工作，收集样本、分析数据。他们惊喜地发现，这个星球上的某些物质具有前所未见的能量潜力，足以革命性地推动人类文明的进步。  
  
然而，就在他们准备深入探索的时候，一支神秘的土著力量突然出现，用强大的科技武器将探险队团团围住。原来，塞菲罗斯星球并不是一个无人的荒野，而是一个隐藏在宇宙深处的古老文明的家园。这个文明拥有超越人类的技术和力量，他们对于探险队的到来感到既好奇又警惕...  
  
探险队和土著力量之间的紧张对峙，揭开了一个全新篇章的序幕。人类和塞菲罗斯星球上的文明，将如何相处？探险队能否平安返回地球，带回他们宝贵的发现？一切，都还是未知数……（略）
```

###  2.2.4 规律提示

例子1

输入：

```
小鸭，嘎嘎嘎
小鸡，叽叽叽
青蛙，
```

输出：

```
呱呱呱
```

---

例子2

输入：

```
¥2,344,540
贰佰叁拾肆万肆仟伍佰肆拾元整
¥13,503元
壹万叁仟伍佰零叁元整
¥9,983元
->
```

输出：

```
玖仟玖佰捌拾叁元整
```

###  2.2.5 少样本提示

输入：

```
# 任务描述
请对以下每一行文本纠错，找出其中的错别字，并按照输出格式要求输出。

# 错别字
熊猫打滚，可爱又玩皮
熊猫血，珍贵无敝
熊猫国宝，人见人哀

# 输出格式
原始文本行（错字→对字）

# 输出示例
熊猫眼，黑白分名（名→明）
...

# 输出
->
```

输出：

```
熊猫打滚，可爱又玩皮（玩→顽）
熊猫血，珍贵无敝（敝→比）
熊猫国宝，人见人哀（哀→爱）
```

###  2.2.6 取值范围提示

输入：

```
# 任务描述
从给定文本中抽取性别（gender: int）、年龄（age: int）和职业（job: string）信息，并按照JSON格式输出，不需要输出其他解释。

字段名称: 枚举范围
---
gender: (未知: 1, 男: 2, 女: 3)
age:
job:

# 输入
大家好，我是一个羞涩的小男孩，今年十二岁，还是个学生，在北京一零一中学读书。
# 输出
``` json
```

输出：

```
{ "gender": 2, "age": 12, "job": "学生" }
```

## 2.3 提示编排设计

split_texts_by_limit的函数

```python
import requests
from bs4 import BeautifulSoup

def get_article_texts(url):
    # 从指定的网址获取文本内容
    response = requests.get(url)
    soup = BeautifulSoup(response.text, "html.parser")
    article = soup.find("div", class_ = "J-lemma-content")
    paragraphs = article.find_all("div")
    texts = [p.get_text(strip = True) for p in paragraphs]
    return texts

def split_texts_by_limit(texts, limit):
    # 按照每次不超过limit个字的限制，将列表中的段落合并成为一个新的组
    groups = []
    group = ""

    for text in texts:
        if len(group) + len(text) <= limit:
            group += text
        else:
            groups.append(group)
            group = text
    if group:
        groups.append(group)
    return groups

def main():
    url = "https://baike.baidu.com/item/大熊猫/34935"
    texts = get_article_texts(url)
    groups = split_texts_by_limit(texts, 1800)
    print(f"全文共有 {sum(len(text) for text in texts)} 个字\n")
    print(f"共有 {len(groups)} 个组\n")
    for i, group in enumerate(groups, 1):
        print(f"第 {i} 个组，共有 {len(group)} 个字：\n{group}\n")

if __name__ == "__main__":
    main()
```

---

###  2.3.1 映射-化简策略

输入：

```
groups = split_texts_by_limit(texts, 1800)
```

输出：

```
全文共有19493字
共有12组

第1组，共有1669字：物种学史播报编辑编辑进化大熊猫的历史可谓源远流长。迄今所发现的最古老大熊猫成员——始熊猫的化石出土于中国云南禄丰和元谋两地……（略）

第12组，共有1409字：熊猫基因组图谱的绘制完成，有助于从基因角度破解为何熊猫繁殖能力低下的疑问……（略）
```

---

输入：

````
# 任务描述
您的任务是阅读如下文本，概括这段文本讲述了什么内容，要求输出不超过250字。

```text
第1组，共有1669字：物种学史播报编辑编辑进化大熊猫的历史可谓源远流长。迄今所发现的最古老大熊猫成员——始熊猫的化石出土于中国云南禄丰和元谋两地……（略）
```

# 输出
这段文本主要讲述了：->
````

输出：

```
这段文本主要讲述了：大熊猫的历史、发现、命名和特征。首先介绍了大熊猫的进化历史，包括其祖先始熊猫的出现和演化过程，以及大熊猫适应亚热带竹林生活的过程。接着讲述了大熊猫在中国文化中的历史记载，以及1869年法国博物学家阿尔芒·戴维德在中国四川发现大熊猫的过程。文章还详细描述了大熊猫的命名过程，最初被命名为“猫熊”，后来因为书写方式的改变和误读，逐渐演变成了现在的“熊猫”。最后，文章提到了大熊猫的特征，包括其体型、毛色和食性等方面。整篇文本通过介绍大熊猫的历史和特征，展示了这一珍稀动物的文化和科学价值。
```

---

输入：

````
# 任务描述
请结合如下各个片段的总结，生成全文总结。

```text
- 这段文本主要讲述了：大熊猫的历史、发现、命名和特征。首先介绍了大熊猫的进化历史，包括其祖先始熊猫的出现和演化过程，以及大熊猫适应亚热带竹林生活的过程……（略）

- 这段文本主要讲述了：大熊猫基因组图谱的绘制完成及其意义，世界自然基金会（WWF）的标志大熊猫在全球的使用和保护宣传活动的相关情况……（略）

……（略）
```
# 输出
->
````

输出：

```
本文围绕大熊猫展开，介绍了其历史、特征、生活习性、分布范围和保护现状等方面。首先讲述了大熊猫的进化历史、发现过程、命名变化和文化意义；接着描述了大熊猫在西方世界引起的关注及其形态特征和生活习性；随后介绍了大熊猫的食性、牙齿结构、前掌特点、食物获取方式，以及在不同地区的分布；随后阐述了大熊猫的繁殖方式、幼仔成长过程及保护措施；最后强调了大熊猫保护工作的重要性及取得的成效，并介绍了大熊猫基因组图谱的绘制完成及其意义，同时也展示了熊猫文化的影响力。
```

###  2.3.2 长文本滚动策略

输入：

```
groups = split_texts_by_limit(texts, 1500)
```

输出：

```
全文共有19493字
共有15组

第1组，共有1442字：物种学史播报编辑编辑进化大熊猫的历史可谓源远流长。迄今所发现的最古老大熊猫成员——始熊猫的化石出土于中国云南禄丰和元谋两地……（略）

第15组，共有920字：大熊猫作为WWF的知名标志，在全球广泛使用，并为世人所熟知。1961年，大熊猫“熙熙”到应该伦敦动物园借展，造成万人空巷的场面……（略）
```

---

输入：

```
# 任务描述
你的任务是从提供的文本内容中提取"动物名称、所属科目、体重、栖息地、发现时间、繁殖年龄、妊娠期、食物和睡觉时长"等字段信息。请根据原文，将已抽取的字段信息进行完善，而对于未能从文章中直接抽取到的字段，请保留空白。最终以KV格式输出所有提取到的数据，注意，此过程不得使用搜索工具。

# 已抽取字段
动物名称: 未知
所属科目: 未知
发现时间: 未知
体重: 未知
栖息地: 未知
繁殖年龄: 未知
妊娠期: 未知
食物: 未知

# 文本内容
第1组，共有1442字：物种学史播报编辑编辑进化大熊猫的历史可谓源远流长。迄今所发现的最古老大熊猫成员——始熊猫的化石出土于中国云南禄丰和元谋两地……（略）

# 输出
``` kv
```

输出：

```
动物名称: 大熊猫
所属科目: 熊科
体重: 80-120千克，最重可达180千克
栖息地: 中国（四川省、陕西省和甘肃省）
发现时间: 1869年
繁殖年龄: 圈养条件下雌性4岁左右，雄性6岁左右
妊娠期: 82.2.0天
食物: 竹子、竹鼠、精饲料、水果、维生素和微量元素添加剂
```

###  2.3.3 多阶段拆分策略

输入：

```
# 任务描述
// 原始问题
如果一个自然保护区有15只大熊猫和10只金丝猴，早上这15只大熊猫获得了喂食，中午增加了4只大熊猫和6只金丝猴，这个自然保护区一共有多少只动物？

// 问题拆解触发器，
为了解决“这个自然保护区一共有多少只动物？”这个问题，首先需要解决的问题有：
```

输出：

```
一、最初有多少只动物？
二、增加了多少只动物？
```

---

输入：

```
# 任务描述
// 原始问题，拼接拆解的子问题
如果一个自然保护区有15只大熊猫和10只金丝猴，早上这15只大熊猫获得了喂食，中午增加了4只大熊猫和6只金丝猴。那么：
一、最初有多少只动物？
二、增加了多少只动物？
```

输出：

```
答：
一、最初有15只大熊猫和10只金丝猴，共25只动物。
二、增加了4只大熊猫和6只金丝猴，共10只动物。
```

---

输入：

```
# 任务描述
// 原始问题
如果一个自然保护区有15只大熊猫和10只金丝猴，早上这15只大熊猫获得了喂食，中午增加了4只大熊猫和6只金丝猴

// 子问题+答案拼接
问：一、最初有多少只动物？
答：最初有15只大熊猫和10只金丝猴，共25只动物。
问：二、增加了多少只动物？
答：增加了4只大熊猫和6只金丝猴，共10只动物。

// 汇总答案
综上，这个自然保护区一共有多少只动物？
```

输出：

```
答：这个自然保护区一共有35只动物。
```
